<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>用mouseout事件冒泡阶段模拟mouseleave事件</title>
    <style>
        .wrap {
            width: 50%;
            box-sizing: border-box;
            float: left;
        }

        .wrap, .list {
            border: solid 1px green;
            padding: 30px;
            margin: 30px 0;
        }

        .list {
            border: solid 1px red;
        }

        .list li {
            border: solid 1px blue;
            padding: 10px;
            margin: 10px;
        }

        .count {
            color: red;
        }
    </style>
</head>
<body>
<div class="wrap">
    wrap, mouseleave
    <ul class="mouseleave list">
        count: <span class="count"></span>
        <li>1</li>
        <li>2</li>
        <li>3</li>
    </ul>
</div>

<div class="wrap">
    wrap, emulate mouseleave,用mouseout模拟实现mouseleave
    <ul class="emulate-mouseleave list">
        count: <span class="count"></span>
        <li>1</li>
        <li>2</li>
        <li>3</li>
    </ul>
</div>
</body>
<script>
    let docEle = document.documentElement
    let contains = docEle.contains ? function (parent, node) {
        return parent !== node && parent.contains(node)
    } : function (parent, node) {
        let result = parent !== node

        if (!result) { // 排除parent与node传入相同的节点
            return result
        }

        if (result) {
            while (node && (node = node.parentNode)) {
                if (parent === node) {
                    return true
                }
            }
        }

        return false
    }


    let $mouseleave = document.querySelector('.mouseleave')
    let $emulatemouseleave = document.querySelector('.emulate-mouseleave')

    let $enterCount = document.querySelector('.mouseleave .count')
    let $emulatemouseleaveCounter = document.querySelector('.emulate-mouseleave .count')

    let addCount = function (ele, start = 0) {
        return function () {
            ele.innerHTML = ++start
        }
    }

    let emulatemouseleaveCallback = addCount($emulatemouseleaveCounter)

    let emulateEnterOrLeave = function (callback) {
        return function (e) {
            let relatedTarget = e.relatedTarget

            //当子元素超出父元素后，到达比父元素更高层的元素时，结果为false，这种判断方式不可取
            console.log('e.relatedTarget === this.parentNode:',e.relatedTarget === this.parentNode)

            //this指向绑定事件的DOM节点也就是currentTarget,也就是ul节点
//            e.relatedTarget !== target(目标元素)
//            console.log(this);
            if (relatedTarget !== this && !contains(this, relatedTarget)) {
                callback.apply(this, arguments)
            }
        }
    }


    //mouseleave 、mouseleave 不支持事件的冒泡，最后一个参数false表示在冒泡阶段调用处理程序
    //因此，这两个事件的冒泡处理也可以分别用 mouseover 和 mouseout 来模拟。
    $mouseleave.addEventListener('mouseleave', addCount($enterCount), false)

    //mouseover、mouseout支持冒泡
    $emulatemouseleave.addEventListener('mouseout', emulateEnterOrLeave(emulatemouseleaveCallback), false)

</script>
</html>